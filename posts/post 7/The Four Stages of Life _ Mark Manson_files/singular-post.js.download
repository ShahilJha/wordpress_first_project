jQuery(document).ready(function(){if(jQuery('body').hasClass('logged-in')){if(readFBCookie('MMFacebook')!=null){jQuery('#article-finished').css("display","none");}else{jQuery('footer.entry-footer').waypoint(function(direction){jQuery('#article-finished').toggleClass('hiding',direction==="up");},{offset:'100%'});}}else{if(readFBCookie('HideEmailSlideout')!=null){jQuery('#article-finished').css("display","none");}else{jQuery('.footer-opt-in').waypoint(function(direction){jQuery('#article-finished').toggleClass('hiding',direction==="up");},{offset:'100%'});}}
function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString();}
else var expires="";document.cookie=name+"="+value+expires+"; path=/";}
jQuery('.no-show-email a').on("click",function(event){event.preventDefault();jQuery('#article-finished').css("display","none");createCookie("HideEmailSlideout",1,1000);});jQuery('.no-show-fb a').on("click",function(event){event.preventDefault();jQuery('#article-finished').css("display","none");createCookie("MMFacebook",1,1000);});jQuery('form#slideout-form').on('submit',function(e){e.preventDefault();jQuery('#slideout-submit').prop('disabled',true);jQuery.post('https://markmanson.net/test/api/ontraport-api-basic.php',jQuery(this).serialize(),function(data){if(data.status==='error'){jQuery('#slideout-form-error').text(data.message).show();jQuery('#slideout-form-success').hide();}else{jQuery('#slideout-form-success').text("You subscribed! Check your inbox.").show();jQuery('#slideout-form-error').hide();jQuery('#slideout-email-input').hide();jQuery('#slideout-submit').hide();ga('set','dimension1','Subscribed to Email List');ga('set','metric2',1);ga('send',{hitType:'event',eventCategory:'Form submission',eventAction:'Newsletter opt-in flyout',eventLabel:window.location.pathname});fbq('track','NewsletterSignupAjax');}}).fail(function(){jQuery('#slideout-form-message').text("Something went wrong.");}).always(function(){jQuery('#slideout-submit').prop('disabled',false);});});function readFBCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
return null;}
var winHeight=jQuery(window).height(),docHeight=jQuery(document).height(),progressBar=jQuery('progress'),articleCover=jQuery('.article-cover'),max,value,articleCoverHeight;jQuery(document).on('scroll',function(){articleCoverHeight=articleCover.height();max=docHeight-winHeight-articleCoverHeight;progressBar.attr('max',max);value=jQuery(window).scrollTop()-articleCoverHeight;if(value>=0){progressBar.attr('value',value);}else{progressBar.attr('value',0);}
if(value>0){jQuery('body').addClass('header-fixed');}else{jQuery('body').removeClass('header-fixed');}});jQuery('.fixed-navigation-dropdown').click(function(e){e.preventDefault();var currentValue=jQuery(this).attr('data-dropdown');if(currentValue=='true'){jQuery('[data-dropdown]').attr('data-dropdown',false);}
else{jQuery('[data-dropdown]').attr('data-dropdown',true);var marginTop=jQuery('.site-header__title-row').height()+jQuery('progress').height();jQuery('.fixed-nav-categories').css('top',marginTop);}});jQuery('.site-header__search-icon').click(function(e){e.preventDefault();jQuery('.fixed-site-header').toggleClass('search-active');if(navigator.userAgent.match(/(iPod|iPhone|iPad)/i)){jQuery('body').toggleClass('search-active-in-header');}});jQuery(document).on('click',function(e){if(!jQuery(e.target).closest('.fixed-navigation-dropdown, .fixed-nav-categories__container').length){jQuery('[data-dropdown]').attr('data-dropdown',false);}
if(!jQuery(e.target).closest('.site-header__search-icon, .site-header__search, .site-header__search-results').length){jQuery('.fixed-site-header').removeClass('search-active');jQuery('body').removeClass('search-active-in-header');}});var delay=(function(){var timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);};})();function showSearchResultsWithDelay(searchQuery){if(searchQuery.length>=3){delay(function(){jQuery.post(ajax_object.ajax_url,{action:"load_search_results",search:searchQuery},function(response){var currentQuery=jQuery('.site-header__search input').val();if(currentQuery.length>=3){jQuery('.search-results__results').html(response).show();jQuery('.search-results__default').hide();}else{jQuery('.search-results__default').show();jQuery('.search-results__results').hide();}});},400);}else{jQuery('.search-results__default').show();jQuery('.search-results__results').hide();}}
jQuery('.site-header__search input').on('propertychange input',function(e){var searchQuery=this.value;var valueChanged=false;if(e.type=='propertychange'){valueChanged=e.originalEvent.propertyName=='value';}else{valueChanged=true;}
if(valueChanged){showSearchResultsWithDelay(searchQuery);}});audiojs.events.ready(function(){var as=audiojs.createAll({createPlayer:{markup:'\
			  <div class="play-pause"> \
			    <p class="play"></p> \
			    <p class="pause"></p> \
			    <p class="loading"></p> \
			    <p class="error"></p> \
			  </div> \
			  <div class="time"> \
			    <span class="played">00:00</span> \
			  </div> \
			  <div class="scrubber"> \
			    <div class="progress"></div> \
			    <div class="loaded"></div> \
			  </div> \
			  <div class="time"> \
			    <span class="duration">00:00</span> \
			  </div> \
			  <div class="error-message"></div>',playPauseClass:'play-pause',scrubberClass:'scrubber',progressClass:'progress',loaderClass:'loaded',timeClass:'time',durationClass:'duration',playedClass:'played',errorMessageClass:'error-message',playingClass:'playing',loadingClass:'loading',errorClass:'error'},play:function(){jQuery(this.element).parent().addClass('playing');jQuery('.playing i.fa').removeClass('fa-volume-up fa-commenting fa-play').addClass('fa-pause');},pause:function(){jQuery(this.element).parent().removeClass('playing');jQuery('.fa-pause').toggleClass('fa-play fa-pause');}});var audio=as[0];jQuery('.audio-link').click(function(e){e.preventDefault();var $thisParent=jQuery(this).parent();var eventAction;var eventLabel=window.location.pathname;if($thisParent.hasClass('site-header__audio-commentary')){ga('set','metric4',1);eventAction="Played Header Commentary Audio";}else if($thisParent.hasClass('site-header__article-audio')){ga('set','metric3',1);eventAction="Played Header Article Audio";}
if(!$thisParent.hasClass('has-played')){ga('send','event',{'eventCategory':'Audio','eventAction':eventAction,'eventLabel':eventLabel});$thisParent.addClass('has-played');}
if($thisParent.hasClass('playing')){audio.playPause();}else{$thisParent.siblings().hide();jQuery('.site-header__audio-player').addClass('playing').show();$thisParent.addClass('playing');if($thisParent.hasClass('playing-active')){audio.playPause();}else{jQuery('.playing-active').removeClass('playing-active');$thisParent.addClass('playing-active');audio.load(jQuery(this).attr('data-src'));audio.play();}}});jQuery('.audio-player-close-button').click(function(){audio.pause();jQuery('.playing').removeClass('playing');jQuery('.fa-pause').removeClass('fa-pause');jQuery('.fa-play').removeClass('fa-play');jQuery('.site-header__audio-commentary i.fa').addClass('fa-commenting');jQuery('.site-header__article-audio i.fa').addClass('fa-volume-up');jQuery('.site-header__audio-player').hide();jQuery(this).parent().siblings().show();});});});